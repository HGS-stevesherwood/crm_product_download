@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<IEnumerable<CRM.Modules.CRMProductDownload.Models.Item>>

@using System.Text.RegularExpressions
@using DotNetNuke.Web.Mvc.Helpers

<div id="Items-@Dnn.ModuleContext.ModuleId">

    @if (Model.Count() == 0)
    {
        <p>@Dnn.LocalizeString("NoItems")</p>
    }
    else
    {
        <hr />
        <form asp-action="Item" method="Index">
            <div class="form-actions no-color">
                <p>
                    <label for="releaseView"><b>@Dnn.LocalizeString("ReleaseView")</b></label>
                    <a href="@Url.Action("Index", "Item", new { viewOrder = ViewBag.LatestSortParam })">@Dnn.LocalizeString("CurrentView")</a>
                    <a href="@Url.Action("Index", "Item", new { viewOrder = ViewBag.PreviousSortParam })">@Dnn.LocalizeString("PriorView")</a>
                    @{
                        if (Dnn.ModuleContext.IsEditable)
                        {
                            <a href="@Url.Action("Index", "Item", new { viewOrder = ViewBag.AllSortParam })">@Dnn.LocalizeString("StagedView")</a>
                        }
                    }
                </p>
            </div>
            <div class="form-actions no-color">
                <p>
                    <label for="releaseView"><b>@Dnn.LocalizeString("FilterView")</b></label> <input type="text" name="SearchString" value="@ViewData["CurrentFilter"]" />
                    <input type="submit" value="Search" class="btn btn-default" />
                </p>
            </div>
        </form>
        <hr />
        <table class="table table-bordered table-responsive table-hover">

            <tr>
                <th>
                    <a href="@Url.Action("Index", "Item", new { sortOrder = ViewBag.NameSortParam, viewOrder = ViewBag.ViewFilter })">@Dnn.LocalizeString("NameSort")</a>
                </th>
                <th>
                    <a href="@Url.Action("Index", "Item", new { sortOrder = ViewBag.VersionSortParam, viewOrder = ViewBag.ViewFilter })">@Dnn.LocalizeString("VersionSort")</a>
                </th>
                <th>
                    <a href="@Url.Action("Index", "Item", new { sortOrder = ViewBag.PlatformSortParam, viewOrder = ViewBag.ViewFilter })">@Dnn.LocalizeString("PlatformSort")</a>
                </th>
                <th>Description</th>
                <th>Release Notes</th>
                <th>Installation Guide</th>
                <th>Download</th>
                @{
                    if (Dnn.ModuleContext.IsEditable)
                    {
                        <th>Publication</th>
                    }
                }

                @foreach (var item in Model)
                {

<tr>
                <td>@item.ItemName</td>
                <td>@item.ItemVersion</td>
                <td>@item.ItemPlatform</td>
                <td>@item.ItemDescription</td>
                <td>
                    <a href="@Url.Action("Release", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("ReleaseNotes")</a>
                </td>
                <td>
                    <a href="@Url.Action("Installation", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("InstallationGuide")</a>
                </td>
                <td>
                    <a href="@Url.Action("Activate", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("DownloadItem")</a>
                </td>
                
                @{
                  if (Dnn.ModuleContext.IsEditable)
                  {
                   <td>
                    <div>
                        <a href="@Url.Action("Edit", "Item", new { ctl = "Edit", itemId = item.ItemId })">@Dnn.LocalizeString("EditItem")</a>
                        <a href="@Url.Action("Delete", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("DeleteItem")</a>
                        @{

                            if (item.ItemLatest == "true" && item.ItemPublished == "true")
                            {
                                <a href="@Url.Action("UnPublish", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("lblUnPublish")</a>
                                <a href="@Url.Action("Demote", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("lblDemote")</a>
                            }


                            if (item.ItemLatest == "false" && item.ItemPublished == "true")
                            {
                                <a href="@Url.Action("UnPublish", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("lblUnPublish")</a>
                                <a href="@Url.Action("Promote", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("lblPromote")</a>
                            }

                            if (item.ItemPublished == "false")
                            {
                                <a href="@Url.Action("Publish", "Item", new { itemId = item.ItemId })">@Dnn.LocalizeString("lblPublish")</a>
                            }

                        }
                    </div>
                </td>
                }
             }
            </tr>
            }

        </table>
    }
</div>
